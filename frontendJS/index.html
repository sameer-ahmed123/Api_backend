<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Api testing</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>

<body>

    <button id="lod_task">load tsk</button>


    <div id="main_div"></div>

    </div>


    <button id="delete_tsk">dlete</button>

    <script>
        const dle_btns = document.querySelectorAll(".delete_tsk")

        function handleButtonClick(event) {
            const slug = event.target.getAttribute('value');
            console.log(slug);
            // You can use the slug value in your API request
            // Add your API request logic here
        }


        dle_btns.forEach(delButton => {
            delButton.addEventListener("click", handleButtonClick)
        })
        /* let slug = "task-1"
         const endp = `http://localhost:8000/api/task/${slug}/delete/`
         let options = {
             method: 'DELETE', // The HTTP method to use
         }
 
         dle_btn.addEventListener("click", () => {
             fetch(endp, options)
                 .then(response => {
                     if (!response.ok) {
                         console.log("could not delete the tsk")
                     }
                     else {
                         console.log(response.status)
                         alert("deleted  tsk")
                         return response.json()
                     }
                 })
                 .catch(error => {
                     console.error('Error:', error);
                 });
         })
 */

    </script>

    <script>
        const endpoint = "http://localhost:8000/api/tasks"

        const load_btn = document.getElementById("lod_task")
        const main_div = document.getElementById("main_div")

        load_btn.addEventListener("click", () => {
            fetch(endpoint)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data && data.length > 0) {
                        data.forEach(tskl => {
                            const Tcard = document.createElement("div")
                            Tcard.classList.add("card")
                            Tcard.style = "height:100vh;display:flex;justify-content:center;align-items:center;flex-direction:column;gap:15px;"

                            // Update content based on tasks

                            var tskNAME = document.createElement("p")
                            tskNAME.innerText = tskl.Task_title;
                            tskNAME.classList.add("card-title")

                            var tskContent = document.createElement("p")
                            tskContent.innerText = tskl.Content;
                            tskContent.classList.add("card-text")

                            var tskslug = document.createElement("p")
                            tskslug.innerText = tskl.Slug;
                            tskslug.classList.add("card-text")

                            var tskDel = document.createElement("button")
                            tskDel.value = tskl.Slug
                            tskDel.innerText = "Delete Task!"
                            tskDel.classList.add("delete_tsk")


                            var ddiv = document.createElement("div")
                            var div = document.createElement("div")
                            div.classList.add("bodcard-y")

                            ddiv.appendChild(tskNAME)
                            ddiv.appendChild(tskContent)
                            ddiv.appendChild(tskslug)
                            ddiv.appendChild(tskDel)



                            var tskName = Tcard.querySelector(".tsk_name");
                            var tskslug = Tcard.querySelector(".tsk_slug");



                            Tcard.appendChild(ddiv)
                            main_div.appendChild(Tcard)




                        })
                    }
                    else {
                        console.log("....")
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        })




    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>


</body>

</html>